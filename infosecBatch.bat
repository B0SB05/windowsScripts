@echo off
echo ---------------------------------------------------------
echo ---------------------------------------------------------
echo ---------------------------------------------------------
echo - Copyrights Information Security Team-Raya Data Center -
echo ---------------------------------------------------------
echo ---------------------------------------------------------
echo ---------------------------------------------------------


rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------
rem ---------- Know my Ip address using resolution through ICMP ping forced to use IPV4 ------------ 
rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------

:start
set today=%Date:~4,10%_%time:~0,5%
set today=%today:/=%
set today=%today::=%
echo ------------------------------------
echo [*] Fetching My Ip Address
for /f "delims=[] tokens=2" %%a in ('ping -4 %computername% -n 1 ^| findstr "["') do (set myip=%%a)
echo [-] My IPV4 Address : %myip%

rem Shared folder Read to Everyone 
echo Shared folder Read to Everyone 
mkdir C:\WUKAV & net share WUKAV$=C:\WUKAV /GRANT:Everyone,READ >> Log 2>&1
cd C:\WUKAV
mkdir %myip%_%today%
echo %myip%_%today% >> %myip%_recordTrack.txt
cd %myip%_%today%
GOTO windowsCheckUpdate

rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------
rem ----- Checking Windows Update,Security Update , hotfixes and Service Pack Installed ------------
rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------

:windowsCheckUpdate
echo ------------------------------------
echo [*] Fetching My Windows Update ..... 
WMIC QFE GET /format:csv > %myip%_%today%_windowsUpdate.csv 2>&1
GOTO KAVCheckUpdate

rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------
rem ------------------------ Checking Kaspersky anti-virus Update ----------------------------------
rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------

:KAVCheckUpdate
echo ------------------------------------
echo [*] Fetching My KAV update date
dir C:\  /s /b  | find "avp.com" > avp.txt 2>&1
set /p myavp=< avp.txt
"%myavp%" statistics updater > "%myip%_%today%_KAVUpdate.txt" 2>&1
GOTO end

rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------
rem ------------------------- Comprise file and copy them to shared folder -------------------------
rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------
rem ------------------------------------------------------------------------------------------------

:end
echo ------------------------------------
echo [*] Packing Process and Sending to Central node ....
